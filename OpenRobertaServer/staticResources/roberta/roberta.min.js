function initUserState(){userState.version="xx.xx.xx",userState.language="DE",userState.robot="ev3",userState.id=-1,userState.accountName="",userState.name="",userState.program="NEPOprog",userState.configuration="EV3basis",userState.programSaved=!1,userState.configurationSaved=!1,userState.programModified=!1,userState.programShared=!1,userState.programTimestamp="",userState.configurationModified=!1,userState.toolbox="beginner",userState.token="1A2B3C4D",userState.doPing=!0,userState.robotName="",userState.robotState="",userState.robotBattery="",userState.robotWait="",userState.robotVersion="",userState.serverVersion="",userState.programBlocks=null,userState.programBlocksSaved=null,userState.bricklyReady=!1,userState.blocklyReady=!1,userState.blocklyTranslated=!1,userState.bricklyTranslated=!1}function login(){USER.login($("#accountNameS").val(),$("#pass1S").val(),function(a){"ok"===a.rc&&(userState.accountName=a.userAccountName,void 0===a.userName||""===a.userName?userState.name=a.userAccountName:userState.name=a.userName,userState.id=a.userId,setHeadNavigationMenuState("login"),setRobotState(a)),displayInformation(a,"MESSAGE_USER_LOGIN",a.message,userState.name)})}function logout(){USER.logout(function(a){"ok"===a.rc&&(initUserState(),$("#programNameSave :not(btn)").val(""),$("#configurationNameSave :not(btn)").val(""),setHeadNavigationMenuState("logout"),Blockly.getMainWorkspace().saveButton.disable(),setRobotState(a),$("#tabProgram").click()),displayInformation(a,"MESSAGE_USER_LOGOUT",a.message)})}function saveUserToServer(){$("#pass1").val()!=$("#pass2").val()?displayMessage("MESSAGE_PASSWORD_ERROR","POPUP",""):USER.saveUserToServer($("#accountName").val(),$("#userName").val(),$("#userEmail").val(),$("#pass1").val(),function(a){"ok"===a.rc&&(setRobotState(a),$("#accountNameS").val($("#accountName").val()),$("#pass1S").val($("#pass1").val()),login()),displayInformation(a,"",a.message)})}function deleteUserOnServer(){USER.deleteUserOnServer(userState.accountName,$("#pass1D").val(),function(a){"ok"===a.rc&&logout(),displayInformation(a,"MESSAGE_USER_DELETED",a.message,userState.name)})}function handleFirmwareConflict(){var a="(.+..+)..+",b=userState.serverVersion.match(a)[1],c=userState.robotVersion.match(a)[1];return b>c?(LOG.info("The firmware version '"+userState.serverVersion+"' on the server is newer than the firmware version '"+userState.robotVersion+"' on the robot"),$("#confirmUpdateFirmware").modal("show"),!0):c>b?(LOG.info("The firmware version '"+userState.serverVersion+"' on the server is older than the firmware version '"+userState.robotVersion+"' on the robot"),displayMessage("MESSAGE_FIRMWARE_ERROR","POPUP",""),!0):!1}function updateFirmware(){ROBOT.updateFirmware(function(a){setRobotState(a),"ok"===a.rc?(displayMessage("MESSAGE_RESTART_ROBOT","POPUP",""),userState.robotState="disconnected"):displayInformation(a,"",a.message,userState.robotFirmware)})}function showUserInfo(){$("#loggedIn").text(userState.name),-1!=userState.id?$("#popup_username").text(Blockly.Msg.POPUP_USERNAME+": "):$("#popup_username").text(Blockly.Msg.POPUP_USERNAME_LOGOFF),$("#programName").text(userState.program),$("#configurationName").text(userState.configuration),"beginner"===userState.toolbox?$("#toolbox").text(Blockly.Msg.MENU_BEGINNER):$("#toolbox").text(Blockly.Msg.MENU_EXPERT),$("#show-state-info").modal("show")}function showRobotInfo(){if(userState.robotName){$("#robotName").text(userState.robotName),"wait"===userState.robotState?($("#robotStateWait").css("display","inline"),$("#robotStateDisconnected").css("display","none"),$("#robotStateBusy").css("display","none")):"busy"===userState.robotState?($("#robotStateWait").css("display","none"),$("#robotStateDisconnected").css("display","none"),$("#robotStateBusy").css("display","inline")):($("#robotStateWait").css("display","none"),$("#robotStateDisconnected").css("display","inline"),$("#robotStateBusy").css("display","none")),"EN"==userState.language?$("#robotBattery").text(userState.robotBattery+" V"):$("#robotBattery").text(userState.robotBattery.toString().replace(".",",")+" V");var a=parseInt(userState.robotWait,10);1e3>a?$("#robotWait").text(a+" ms"):$("#robotWait").text(Math.round(a/1e3)+" s"),$("#show-robot-info").modal("show")}else displayMessage("ORA_ROBOT_NOT_CONNECTED","POPUP","")}function injectBlockly(a,b,c){response(a);var d=c|!1;"ok"===a.rc&&(d?($("#blocklyDiv").html(""),Blockly.inject(document.getElementById("blocklyDiv"),{path:"/blockly/",toolbox:a.data,readOnly:!0,trashcan:!1,code:!1,save:!1,check:!1,start:!1})):($("#blocklyDiv").html(""),Blockly.inject(document.getElementById("blocklyDiv"),{path:"/blockly/",toolbox:a.data,trashcan:!0,code:!0,save:!0,check:!0,start:!0})),$(window).width()<768&&d?Blockly.getMainWorkspace().clear():(initProgramEnvironment(b),setRobotState(a)))}function initProgramEnvironment(a){Blockly.getMainWorkspace().clear();var b,c;$(window).width()<768?(b=25,c=25):(b=370,c=50);var d="<block_set xmlns='http: // www.w3.org/1999/xhtml'><instance x='"+b+"' y='"+c+"'><block type='robControls_start'></block></instance></block_set>",e=a||d,f=Blockly.Xml.textToDom(e);Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,f),userState.blocklyReady=!0,Blockly.fireUiEvent(window,"resize")}function setProgram(a){a&&(userState.program=a,$("#tabProgramName").text(a))}function setConfiguration(a){a&&(userState.configuration=a,$("#tabConfigurationName").text(a))}function setToken(a){var b=a.toUpperCase();ROBOT.setToken(b,function(a){"ok"===a.rc&&(userState.token=b),displayInformation(a,"MESSAGE_ROBOT_CONNECTED",a.message,userState.robotName),setRobotState(a),handleFirmwareConflict()})}function response(a){LOG.info("result from server: "+UTIL.formatResultLog(a)),"ok"!=a.rc&&displayMessage(a.message,"POPUP","")}function saveAsProgramToServer(){var a=$("#programNameSave").val().trim();if(!a.match(/^[a-zA-Z][a-zA-Z0-9]*$/))return void displayMessage("MESSAGE_INVALID_NAME","POPUP","");setProgram(a),$("#menuSaveProg").parent().removeClass("login"),$("#menuSaveProg").parent().removeClass("disabled"),Blockly.getMainWorkspace().saveButton.enable();var b=Blockly.Xml.workspaceToDom(Blockly.mainWorkspace),c=Blockly.Xml.domToText(b);userState.programSaved=!0,LOG.info("saveAs program "+userState.program+" login: "+userState.id),$(".modal").modal("hide");var d=UTIL.parseDate(userState.programTimestamp);PROGRAM.saveAsProgramToServer(userState.program,d,c,function(a){"ok"===a.rc&&(userState.programModified=!1,userState.programTimestamp=UTIL.formatDateComplete(a.lastChanged)),displayInformation(a,"MESSAGE_EDIT_SAVE_PROGRAM_AS",a.message,userState.program)})}function saveToServer(){if(userState.program){var a=Blockly.Xml.workspaceToDom(Blockly.mainWorkspace),b=Blockly.Xml.domToText(a);userState.programSaved=!0,LOG.info("save program "+userState.program+" login: "+userState.id),$(".modal").modal("hide");var c=UTIL.parseDate(userState.programTimestamp);PROGRAM.saveProgramToServer(userState.program,userState.programShared,c,b,function(a){"ok"===a.rc&&(userState.programModified=!1,userState.programTimestamp=UTIL.formatDateComplete(a.lastChanged)),displayInformation(a,"MESSAGE_EDIT_SAVE_PROGRAM",a.message,userState.program)})}}function saveAsConfigurationToServer(){var a=$("#configurationNameSave").val();if(!a.match(/^[a-zA-Z][a-zA-Z0-9]*$/))return void displayMessage("MESSAGE_INVALID_NAME","POPUP","");setConfiguration(a),$("#menuSaveConfig").parent().removeClass("login"),$("#menuSaveConfig").parent().removeClass("disabled"),UTIL.getBricklyFrame("#bricklyFrame").Blockly.getMainWorkspace().saveButton.enable(),userState.configurationSaved=!0,$(".modal").modal("hide");var b=UTIL.getBricklyFrame("#bricklyFrame").getXmlOfConfiguration(userState.configuration);LOG.info("save brick configuration "+userState.configuration),CONFIGURATION.saveAsConfigurationToServer(userState.configuration,b,function(a){"ok"===a.rc&&(userState.configurationModified=!1),displayInformation(a,"MESSAGE_EDIT_SAVE_CONFIGURATION_AS",a.message,userState.configuration)})}function saveConfigurationToServer(){if(userState.configuration){userState.configurationSaved=!0,$(".modal").modal("hide");var a=UTIL.getBricklyFrame("#bricklyFrame").getXmlOfConfiguration(userState.configuration);LOG.info("save brick configuration "+userState.configuration),CONFIGURATION.saveConfigurationToServer(userState.configuration,a,function(a){"ok"===a.rc&&(userState.configurationModified=!1),displayInformation(a,"MESSAGE_EDIT_SAVE_CONFIGURATION",a.message,userState.configuration)})}}function showJavaProgram(){LOG.info("show the generated Java program for "+userState.program);var a=Blockly.Xml.workspaceToDom(Blockly.mainWorkspace),b=Blockly.Xml.domToText(a),c=UTIL.getBricklyFrame("#bricklyFrame").getXmlOfConfiguration(userState.configuration);PROGRAM.showJavaProgram(userState.program,userState.configuration,b,c,function(a){setRobotState(a),"ok"==a.rc?displayPopupMessage("Ok-kO",a.javaSource):displayInformation(a,"",a.message,"")})}function runOnBrick(){"ev3"===userState.robot?""===userState.robotState||"disconnected"===userState.robotState?displayMessage("POPUP_ROBOT_NOT_CONNECTED","POPUP",""):"busy"===userState.robotState?displayMessage("POPUP_ROBOT_BUSY","POPUP",""):handleFirmwareConflict()?($("#buttonCancelFirmwareUpdate").css("display","none"),$("#buttonCancelFirmwareUpdateAndRun").css("display","inline")):startProgram():"oraSim"===userState.robot&&startProgram()}function showCode(){if("ev3"===userState.robot){LOG.info("show code "+userState.program+" signed in: "+userState.id);var a=Blockly.Xml.workspaceToDom(Blockly.mainWorkspace),b=Blockly.Xml.domToText(a),c=UTIL.getBricklyFrame("#bricklyFrame").getXmlOfConfiguration(userState.configuration);PROGRAM.showJavaProgram(userState.program,userState.configuration,b,c,function(a){setRobotState(a),$("#blocklyDiv").addClass("codeActive"),$("#blocklyDiv").parent().bind("transitionend",function(){Blockly.fireUiEvent(window,"resize")}),$("#codeDiv").addClass("codeActive"),$(".nav > li > ul > .robotType").addClass("disabled"),$("#head-navigation-program-edit").addClass("disabled"),$("#head-navigation-program-edit>ul").addClass("hidden"),UTIL.cacheBlocks(),COMM.json("/toolbox",{cmd:"loadT",name:userState.toolbox,owner:" "},function(a){injectBlockly(a,userState.programBlocks,!0)}),$(".code").removeClass("hide"),document.getElementById("codeDiv").innerHTML="<textarea>"+a.javaSource+"</textarea>"})}}function startProgram(){LOG.info("run "+userState.program+" signed in: "+userState.id);var a=Blockly.Xml.workspaceToDom(Blockly.mainWorkspace),b=Blockly.Xml.domToText(a),c=UTIL.getBricklyFrame("#bricklyFrame").getXmlOfConfiguration(userState.configuration);Blockly.hasStartButton&&Blockly.getMainWorkspace().startButton.disable(),PROGRAM.runOnBrick(userState.program,userState.configuration,b,c,function(a){setRobotState(a),"ok"==a.rc?"oraSim"===userState.robot?(SIM.init(a.javaScriptProgram),$("#blocklyDiv").addClass("simActive"),$("#blocklyDiv").parent().bind("transitionend",function(){Blockly.fireUiEvent(window,"resize"),setTimeout(function(){SIM.setPause(!1)},1e3)}),$("#simDiv").addClass("simActive"),$("#simButtonsCollapse").collapse({toggle:!1}),$(".nav > li > ul > .robotType").addClass("disabled"),$("#head-navigation-program-edit").addClass("disabled"),$("#head-navigation-program-edit>ul").addClass("hidden"),UTIL.cacheBlocks(),COMM.json("/toolbox",{cmd:"loadT",name:userState.toolbox,owner:" "},function(a){injectBlockly(a,userState.programBlocks,!0)}),$(".sim").removeClass("hide")):displayMessage("MESSAGE_EDIT_START","TOAST",userState.program):(Blockly.getMainWorkspace().startButton.enable(),displayInformation(a,"",a.message,""))})}function checkProgram(){LOG.info("check "+userState.program+" signed in: "+userState.id);var a=Blockly.Xml.workspaceToDom(Blockly.mainWorkspace),b=Blockly.Xml.domToText(a),c=UTIL.getBricklyFrame("#bricklyFrame").getXmlOfConfiguration(userState.configuration);displayMessage("MESSAGE_EDIT_CHECK","TOAST",userState.program),PROGRAM.checkProgramCompatibility(userState.program,userState.configuration,b,c,function(a){if("ok"==a.rc){var b=Blockly.Xml.textToDom(a.data);Blockly.mainWorkspace.clear(),Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,b)}})}function showProgram(a,b,c){if(response(a),"ok"===a.rc){setProgram(c);var d=Blockly.Xml.textToDom(a.data);b&&Blockly.mainWorkspace.clear(),Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,d),LOG.info("show program "+userState.program+" signed in: "+userState.id)}}function showConfiguration(a,b,c){response(a),"ok"===a.rc&&(switchToBrickly(),setConfiguration(c),UTIL.getBricklyFrame("#bricklyFrame").showConfiguration(a.data,b),LOG.info("show configuration "+userState.configuration+" signed in: "+userState.id))}function loadFromListing(){var a=$("#programNameTable .selected");if(a.length>0){var b=a[0].children[0].textContent,c=a[0].children[1].textContent,d=a[0].children[2].textContent;userState.programTimestamp=a[0].children[5].textContent,userState.programShared=!1,$("#menuSaveProg").parent().removeClass("disabled"),Blockly.getMainWorkspace().saveButton.enable(),d===Blockly.Msg.POPUP_SHARE_READ?($("#menuSaveProg").parent().addClass("disabled"),Blockly.getMainWorkspace().saveButton.disable()):d===Blockly.Msg.POPUP_SHARE_WRITE&&(userState.programShared=!0),LOG.info("loadFromList "+b+" signed in: "+userState.id),PROGRAM.loadProgramFromListing(b,c,function(a){"ok"===a.rc&&($("#tabs").tabs("option","active",0),userState.programSaved=!0,showProgram(a,!0,b),$("#menuSaveProg").parent().removeClass("login")),displayInformation(a,"",a.message)})}}function loadConfigurationFromListing(){var a=$("#configurationNameTable .selected");if(a.length>0){var b=a[0].children[0].textContent;LOG.info("loadFromConfigurationList "+b+" signed in: "+userState.id),CONFIGURATION.loadConfigurationFromListing(b,function(a){"ok"===a.rc&&($("#tabs").tabs("option","active",0),userState.configurationSaved=!0,showConfiguration(a,!0,b),$("#menuSaveConfig").parent().removeClass("login"),$("#menuSaveConfig").parent().removeClass("disabled"),setRobotState(a)),displayInformation(a,"",a.message)})}}function shareProgramsFromListing(){var a=$("#programShareWith").val();if(a===userState.name)displayMessage("ORA_USER_TO_SHARE_SAME_AS_LOGIN_USER","POPUP","");else if(""!==a){var b=$("#write:checked").val();if(b||(b=$("#read:checked").val()),b){var c=$("#programNameTable .selected"),d=c[0].children[0].textContent;LOG.info("share program "+d+" with '"+a+" having right '"+b+"'"),PROGRAM.shareProgram(d,a,b,function(a){"ok"!=a.rc&&displayInformation(a,"",a.message),$("#share-program").modal("hide"),PROGRAM.refreshList(showPrograms)})}}$("#relationsTable tbody tr").each(function(a){var b=$(this),c=b.children("td"),d=c.eq(0).text(),e=c.eq(2).text();if(""!==e){var f=c.eq(3).children("input:checked").val(),g=c.eq(4).children("input:checked").val(),h="NONE";"WRITE"===g?h=g:"READ"===f&&(h=f),LOG.info("share program "+d+" with '"+e+" having right '"+h+"'"),PROGRAM.shareProgram(d,e,h,function(a){"ok"===a.rc?(response(a),setRobotState(a),"NONE"===h&&displayInformation(a,"MESSAGE_RELATION_DELETED",a.message,d)):displayInformation(a,"",a.message),$("#share-program").modal("hide"),PROGRAM.refreshList(showPrograms)})}})}function deleteFromListing(){for(var a=$("#programNameTable .selected"),b="",c=0;c<a.length;c++){var d=a[c].children[0].textContent;b.length>0&&(b+=", "),b+=d,LOG.info("deleteFromList "+d+" signed in: "+userState.id),PROGRAM.deleteProgramFromListing(d,function(a){"ok"===a.rc&&(response(a),PROGRAM.refreshList(showPrograms),setRobotState(a),displayInformation(a,"MESSAGE_PROGRAM_DELETED",a.message,d))})}}function deleteConfigurationFromListing(){for(var a=$("#configurationNameTable .selected"),b=0;b<a.length;b++){var c=a[b].children[0].textContent;LOG.info("deleteFromConfigurationList "+c+" signed in: "+userState.id),CONFIGURATION.deleteConfigurationFromListing(c,function(a){"ok"===a.rc&&(response(a),CONFIGURATION.refreshList(showConfigurations),setRobotState(a)),displayInformation(a,"MESSAGE_CONFIGURATION_DELETED",a.message,c)})}}function showToolbox(a,b){response(a),"ok"===a.rc&&(userState.toolbox=b,Blockly.updateToolbox(a.data),setRobotState(a),"beginner"===b?($("#menuToolboxBeginner").parent().addClass("disabled"),$("#menuToolboxExpert").parent().removeClass("disabled"),$("#menuToolboxSimulation").parent().removeClass("disabled")):"expert"===b&&($("#menuToolboxExpert").parent().addClass("disabled"),$("#menuToolboxBeginner").parent().removeClass("disabled"),$("#menuToolboxSimulation").parent().removeClass("disabled")),userState.blocklyTranslated=!0)}function loadToolbox(a){COMM.json("/toolbox",{cmd:"loadT",name:a,owner:" "},function(b){showToolbox(b,a)})}function showPrograms(a){if(response(a),"ok"===a.rc){var b=$("#programNameTable").dataTable();b.fnClearTable(),a.programNames.length>0&&b.fnAddData(a.programNames),setRobotState(a)}}function showConfigurations(a){if(response(a),"ok"===a.rc){var b=$("#configurationNameTable").dataTable();b.fnClearTable(),a.configurationNames.length>0&&b.fnAddData(a.configurationNames),setRobotState(a)}}function showRelations(a){if(response(a),"ok"===a.rc){var b=$("#relationsTable").dataTable();b.fnClearTable(),a.relations.length>0&&b.fnAddData(a.relations),setTimeout(function(){b.fnAdjustColumnSizing()},200),$("#show-relations").modal("show")}}function selectionFn(a){$(a.target.parentNode).toggleClass("selected");var b=a.currentTarget.rowIndex;if(start||(start=b),a.shiftKey){var c=b;for($("#programNameTable tbody tr").removeClass("selected"),i=Math.min(start,c);i<=Math.max(start,c);i++)$(a.target.parentNode.parentNode.childNodes).eq(i).hasClass("selected")||$(a.target.parentNode.parentNode.childNodes).eq(i).addClass("selected");window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}start=b}function beforeActivateTab(a,b){$("#tabs").tabs("refresh"),"#progListing"===b.newPanel.selector?PROGRAM.refreshList(showPrograms):"#confListing"===b.newPanel.selector&&CONFIGURATION.refreshList(showConfigurations)}function initProgramNameTable(){var a=[{sTitle:"<span lkey='Blockly.Msg.DATATABLE_PROGRAM_NAME'>Name des Programms</span>",sClass:"programs"},{sTitle:"<span lkey='Blockly.Msg.DATATABLE_CREATED_BY'>Erzeugt von</span>",sClass:"programs"},{sTitle:"<span lkey='Blockly.Msg.DATATABLE_SHARED'>Geteilt</span>",sClass:"programs"},{sTitle:"<span lkey='Blockly.Msg.DATATABLE_CREATED_ON'>Erzeugt am</span>",sClass:"programs"},{sTitle:"<span lkey='Blockly.Msg.DATATABLE_ACTUALIZATION'>Letzte Aktualisierung</span>",sClass:"programs"},{sTitle:"<span lkey='Blockly.Msg.DATATABLE_ACTUALIZATION'>Letzte Aktualisierung mit Hundertstel Sekunden</span>",sClass:"programs hidden"}],b=$("#programNameTable"),c=b.dataTable({sDom:"<lip>t<r>",aaData:[],aoColumns:a,aoColumnDefs:[{aTargets:[3,4],sType:"date-de",mRender:function(a){return UTIL.formatDate(a)}},{aTargets:[5],sType:"date-de",mRender:function(a){return UTIL.formatDateComplete(a)}},{aTargets:[2],mRender:function(a,b,c){if("WRITE"===a)var d="<span lkey='Blockly.Msg.POPUP_SHARE_WRITE'>"+Blockly.Msg.POPUP_SHARE_WRITE+"</span>";else if("READ"===a)var d="<span lkey='Blockly.Msg.POPUP_SHARE_READ'>"+Blockly.Msg.POPUP_SHARE_READ+"</span>";else if(a===!0)var d="<span lkey='Blockly.Msg.POPUP_SHARE_READ'>X</span>";else if(a===!1)var d="<span lkey='Blockly.Msg.POPUP_SHARE_READ'>-</span>";return d}}],bJQueryUI:!0,oLanguage:{sEmptyTable:"<span lkey='Blockly.Msg.DATATABLE_EMPTY_TABLE'></span>"},fnDrawCallback:function(){},scrollY:UTIL.calcDataTableHeight(),scrollCollapse:!0,paging:!1,bInfo:!1});$(window).resize(function(){var a=c.fnSettings();a.oScroll.sY=UTIL.calcDataTableHeight(),c.fnDraw(!1)}),$("#programNameTable tbody").onWrap("click","tr",selectionFn),$("#programNameTable tbody").onWrap("dblclick","tr",function(a){selectionFn(a),$("#loadFromListing").click()})}function initConfigurationNameTable(){var a=[{sTitle:"<span lkey='Blockly.Msg.DATATABLE_CONFIGURATION_NAME'>Name der Konfiguration</span>",sClass:"configurations"},{sTitle:"<span lkey='Blockly.Msg.DATATABLE_CREATED_BY'>Erzeugt von</span>",sClass:"configurations"},{sTitle:"<span lkey='Blockly.Msg.DATATABLE_CREATED_ON'>Erzeugt am</span>",sClass:"configurations"},{sTitle:"<span lkey='Blockly.Msg.DATATABLE_ACTUALIZATION'>Letzte Aktualisierung</span>",sClass:"configurations"}],b=$("#configurationNameTable"),c=b.dataTable({sDom:"<lip>t<r>",aaData:[],aoColumns:a,aoColumnDefs:[{aTargets:[2,3],sType:"date-de",mRender:function(a){return UTIL.formatDate(a)}}],bJQueryUI:!0,oLanguage:{sEmptyTable:"<span lkey='Blockly.Msg.DATATABLE_EMPTY_TABLE'></span>"},fnDrawCallback:function(){},scrollY:UTIL.calcDataTableHeight(),scrollCollapse:!0,paging:!1,bInfo:!1});$(window).resize(function(){var a=c.fnSettings();a.oScroll.sY=UTIL.calcDataTableHeight(),c.fnDraw(!1)}),$("#configurationNameTable tbody").onWrap("click","tr",selectionFn),$("#configurationNameTable tbody").onWrap("dblclick","tr",function(a){selectionFn(a),$("#loadConfigurationFromListing").click()})}function initRelationsTable(){var a=[{sTitle:"<span lkey='Blockly.Msg.DATATABLE_PROGRAM_NAME'>Name des Programms</span>",sClass:"relations hidden"},{sTitle:"<span lkey='Blockly.Msg.DATATABLE_CREATED_BY'>Erzeugt von</span>",sClass:"relations hidden"},{sTitle:"<span lkey='Blockly.Msg.DATATABLE_SHARED_WITH'>Geteilt mit</span>",sClass:"relations"},{sTitle:"<span lkey='Blockly.Msg.POPUP_SHARE_READ'>Lesen</span>",sClass:"relations"},{sTitle:"<span lkey='Blockly.Msg.POPUP_SHARE_WRITE'>Schreiben</span>",sClass:"relations"}],b=$("#relationsTable"),c=b.dataTable({sDom:"<lip>t<r>",aaData:[],aoColumns:a,aoColumnDefs:[{aTargets:[3],mRender:function(a,b,c){var d="";("WRITE"===c[4]||"READ"===a)&&(d="checked");var e="<td><input class='readRight' type='checkbox' name='right' value='READ' "+d+"></td>";return e}},{aTargets:[4],mRender:function(a,b,c){var d="";"WRITE"===a&&(d="checked");var e="<td><input class='writeRight' type='checkbox' name='right' value='WRITE' "+d+"></td>";return e}}],bJQueryUI:!0,oLanguage:{sEmptyTable:"<span lkey='Blockly.Msg.DATATABLE_EMPTY_TABLE'></span>"},fnDrawCallback:function(){},scrollY:UTIL.calcDataTableHeight(),scrollCollapse:!0,paging:!1,bInfo:!1});$(window).resize(function(){var a=c.fnSettings();a.oScroll.sY=UTIL.calcDataTableHeight(),c.fnDraw(!1)}),$("#relationsTable tbody").onWrap("click","tr",selectionFn),$("#relationsTable_wrapper").css("margin",0)}function switchToBlockly(){$("#tabs").css("display","inline"),$("#bricklyFrame").css("display","none"),$("#simConfiguration").css("display","none"),$("#tabBlockly").click(),Blockly.getMainWorkspace().render(),Blockly.getMainWorkspace().render(),bricklyActive=!1}function switchToBrickly(){"oraSim"===userState.robot?$("#simConfiguration").css("display","block"):($("#bricklyFrame").css("display","inline"),$("#tabs").css("display","none"),UTIL.getBricklyFrame("#bricklyFrame").Blockly.getMainWorkspace().render(),UTIL.getBricklyFrame("#bricklyFrame").loadToolbox()),$("#tabBrickly").click(),bricklyActive=!0}function switchRobot(a){ROBOT.setRobot(a,function(b){"ok"===b.rc&&(userState.robot=a,setRobotState(b),"ev3"===a?(setConfiguration("EV3basis"),$("#blocklyDiv").removeClass("simBackground"),$("#menuEv3").parent().addClass("disabled"),$("#menuSim").parent().removeClass("disabled"),$("#menuConnect").parent().removeClass("disabled"),$("#iconDisplayRobotState").removeClass("typcn-Roberta"),$("#iconDisplayRobotState").addClass("typcn-ev3"),$("#menuShowCode").parent().removeClass("disabled"),Blockly.getMainWorkspace().codeButton.enable(),UTIL.getBricklyFrame("#bricklyFrame").loadToolboxAndConfiguration()):"oraSim"===a&&(userState.robotName="ORSim",setConfiguration("ORSim"),$("#blocklyDiv").addClass("simBackground"),$("#menuEv3").parent().removeClass("disabled"),$("#menuSim").parent().addClass("disabled"),$("#menuConnect").parent().addClass("disabled"),$("#iconDisplayRobotState").removeClass("typcn-ev3"),$("#iconDisplayRobotState").addClass("typcn-Roberta"),$("#menuShowCode").parent().addClass("disabled"),Blockly.getMainWorkspace().codeButton.disable(),PROGRAM.loadProgramFromListing("NEPOprog","Roberta",function(a){"ok"===a.rc&&showProgram(a,!0,"NEPOprog")})),loadToolbox(userState.toolbox))})}function setHeadNavigationMenuState(a){$(".nav > li > ul > .login, .logout").removeClass("disabled"),"login"===a?$(".nav > li > ul > .login").addClass("disabled"):"logout"===a&&$(".nav > li > ul > .logout").addClass("disabled")}function initHeadNavigation(){$(".navbar-fixed-top").onWrap("click",".dropdown-menu li:not(.disabled) a",function(a){Blockly.hideChaff(),$(".modal").modal("hide");var b=a.target.id;return"menuRunProg"===b?runOnBrick():"menuCheckProg"===b?checkProgram():"menuNewProg"===b?newProgram():"menuListProg"===b?(deactivateProgConfigMenu(),$("#tabListing").click()):"menuSaveProg"===b?saveToServer():"menuSaveAsProg"===b?$("#save-program").modal("show"):"menuShowCode"===b?showCode():"menuToolboxBeginner"===b?loadToolbox("beginner"):"menuToolboxExpert"===b?loadToolbox("expert"):"menuCheckConfig"===b?displayMessage("MESSAGE_NOT_AVAILABLE","POPUP",""):"menuNewConfig"===b?(setConfiguration("EV3basis"),UTIL.getBricklyFrame("#bricklyFrame").initConfigurationEnvironment(),$("#menuSaveConfig").parent().addClass("disabled"),UTIL.getBricklyFrame("#bricklyFrame").Blockly.getMainWorkspace().saveButton.disable()):"menuListConfig"===b?(deactivateProgConfigMenu(),$("#tabs").css("display","inline"),$("#bricklyFrame").css("display","none"),$("#simConfiguration").css("display","none"),$("#tabConfigurationListing").click()):"menuSaveConfig"===b?saveConfigurationToServer():"menuSaveAsConfig"===b?$("#save-configuration").modal("show"):"menuEv3"===b?newProgram()&&switchRobot("ev3"):"menuSim"===b?newProgram()&&switchRobot("oraSim"):"menuConnect"===b?($("#buttonCancelFirmwareUpdate").css("display","inline"),$("#buttonCancelFirmwareUpdateAndRun").css("display","none"),$("#set-token").modal("show")):"menuRobotInfo"===b?showRobotInfo():"menuGeneral"===b?window.open("https://mp-devel.iais.fraunhofer.de/wiki/x/BIAM"):"menuEV3conf"===b?window.open("https://mp-devel.iais.fraunhofer.de/wiki/x/RIAd"):"menuProgramming"===b?window.open("https://mp-devel.iais.fraunhofer.de/wiki/x/CwA-/"):"menuFaq"===b?window.open("https://mp-devel.iais.fraunhofer.de/wiki/x/BoAd"):"menuShowRelease"===b?$("#show-release").modal("show"):"menuStateInfo"===b?showUserInfo():"menuAbout"===b?($("#version").text(userState.version),$("#show-about").modal("show")):"menuLogging"===b?(deactivateProgConfigMenu(),$("#tabs").css("display","inline"),$("#bricklyFrame").css("display","none"),$("#simConfiguration").css("display","none"),$("#tabLogging").click()):"menuLogin"===b?$("#login-user").modal("show"):"menuLogout"===b?logout():"menuNewUser"===b?$("#register-user").modal("show"):"menuChangeUser"===b||"menuDeleteUser"===b&&$("#delete-user").modal("show"),!1},"head navigation menu item clicked"),$(".navbar-fixed-top .navbar-nav").onWrap("click","li:not(.disabled) a",function(a){var b=a.target.id;return"menuTabProgram"===b?($("#tabSimulation").hasClass("tabClicked")&&$(".scroller-left").click(),$(".scroller-left").click(),$("#tabProgram").click()):"menuTabConfiguration"===b&&($("#tabProgram").hasClass("tabClicked")?$(".scroller-right").click():$("#tabConfiguration").hasClass("tabClicked")&&$(".scroller-right").click(),$("#tabConfiguration").click()),!1}),$(".navbar-fixed-top").onWrap("mouseleave",function(a){$(".navbar-fixed-top .dropdown").removeClass("open")}),$("#imgLogo, #imgBeta").onWrap("click",function(){window.open("http://open-roberta.org")},"logo was clicked"),$("#beta").onWrap("click",function(){window.open("http://open-roberta.org")},"beta logo was clicked"),$("#iconDisplayLogin").onWrap("click",function(){showUserInfo()},"icon user click"),$("#iconDisplayRobotState").onWrap("click",function(){showRobotInfo()},"icon robot click"),$("#tabProgram").onWrap("click",function(){activateProgConfigMenu(),$("#tabProgram").addClass("tabClicked"),$("#tabConfiguration").removeClass("tabClicked"),$("#tabSimulation").removeClass("tabClicked"),$("#head-navigation-program-edit").css("display","inline"),$("#head-navigation-configuration-edit").css("display","none"),$("#menuTabProgram").parent().addClass("disabled"),$("#menuTabConfiguration").parent().removeClass("disabled"),$("#menuTabSimulation").parent().removeClass("disabled"),switchToBlockly()},"tabProgram clicked"),$("#tabConfiguration").onWrap("click",function(){Blockly.hideChaff(),activateProgConfigMenu(),$("#tabProgram").removeClass("tabClicked"),$("#tabConfiguration").addClass("tabClicked"),$("#tabSimulation").removeClass("tabClicked"),$("#head-navigation-program-edit").css("display","none"),$("#head-navigation-configuration-edit").css("display","inline"),$("#menuTabProgram").parent().removeClass("disabled"),$("#menuTabConfiguration").parent().addClass("disabled"),$("#menuTabSimulation").parent().removeClass("disabled"),switchToBrickly()},"tabConfiguration clicked"),$(".simSimple").onWrap("click",function(a){$(".menuSim").parent().removeClass("disabled"),$(".simSimple").parent().addClass("disabled"),SIM.setBackground(1),$("#simButtonsCollapse").collapse("hide")},"simSimple clicked"),$(".simDraw").onWrap("click",function(a){$(".menuSim").parent().removeClass("disabled"),$(".simDraw").parent().addClass("disabled"),SIM.setBackground(2),$("#simButtonsCollapse").collapse("hide")},"simDraw clicked"),$(".simRoberta").onWrap("click",function(a){$(".menuSim").parent().removeClass("disabled"),$(".simRoberta").parent().addClass("disabled"),SIM.setBackground(3),$("#simButtonsCollapse").collapse("hide")},"simRoberta clicked"),$(".simRescue").onWrap("click",function(a){$(".menuSim").parent().removeClass("disabled"),$(".simRescue").parent().addClass("disabled"),SIM.setBackground(4),$("#simButtonsCollapse").collapse("hide")},"simRescue clicked"),$(".simMath").onWrap("click",function(a){$(".menuSim").parent().removeClass("disabled"),$(".simMath").parent().addClass("disabled"),SIM.setBackground(5),$("#simButtonsCollapse").collapse("hide")},"simRescue clicked"),$(".simBack").onWrap("click",function(a){SIM.cancel(),$("#blocklyDiv").removeClass("simActive"),$("#simDiv").removeClass("simActive"),$(".sim").addClass("hide"),Blockly.fireUiEvent(window,"resize"),$(".nav > li > ul > .robotType").removeClass("disabled"),$("#menuSim").parent().addClass("disabled"),COMM.json("/toolbox",{cmd:"loadT",name:userState.toolbox,owner:" "},function(a){injectBlockly(a,userState.programBlocksSaved)}),$("#simButtonsCollapse").collapse("hide"),$("#head-navi-tooltip-program").removeClass("disabled"),$("#head-navigation-program-edit").removeClass("disabled"),$("#head-navigation-program-edit>ul").removeClass("hidden")},"simBack clicked"),$(".simStop").onWrap("click",function(a){SIM.stopProgram(),$("#simButtonsCollapse").collapse("hide")},"simStop clicked"),$(".simForward").onWrap("click",function(a){$(".simForward").hasClass("typcn-media-play")?SIM.setPause(!1):SIM.setPause(!0),$("#simButtonsCollapse").collapse("hide")},"simForward clicked"),$(".simStep").onWrap("click",function(a){SIM.setStep(),$("#simButtonsCollapse").collapse("hide")},"simStep clicked"),$(".simInfo").onWrap("click",function(a){SIM.setInfo(),$("#simButtonsCollapse").collapse("hide")},"simInfo clicked"),$(".simScene").onWrap("click",function(a){SIM.setBackground(0);var b=$("#simButtonsCollapse").collapse("hide");$(".menuSim").parent().removeClass("disabled"),1==b?$(".simSimple").parent().addClass("disabled"):2==b?$(".simDraw").parent().addClass("disabled"):3==b?$(".simRoberta").parent().addClass("disabled"):4==b?$(".simRescue").parent().addClass("disabled"):5==b&&$(".simMath").parent().addClass("disabled")},"simScene clicked"),$("#startSim").onWrap("click",function(a){switchRobot("oraSim")},"start with simulation clicked"),$("#startEV3").onWrap("click",function(a){switchRobot("ev3")},"start with ev3 clicked"),$(".codeBack").onWrap("click",function(a){
$("#blocklyDiv").removeClass("codeActive"),$("#codeDiv").removeClass("codeActive"),"oraSim"===userState.robot?$("#menuEv3").parent().removeClass("disabled"):$("#menuSim").parent().removeClass("disabled"),Blockly.fireUiEvent(window,"resize"),COMM.json("/toolbox",{cmd:"loadT",name:userState.toolbox,owner:" "},function(a){injectBlockly(a,userState.programBlocksSaved)}),$("#head-navi-tooltip-program").removeClass("disabled"),$("#head-navigation-program-edit").removeClass("disabled"),$("#head-navigation-program-edit>ul").removeClass("hidden"),$(".code").addClass("hide")},"codeBack clicked"),$("#codeDownload").onWrap("click",function(a){var b=new Blob([userState.programCode]),c=document.createElement("a"),d=window.URL||window.webkitURL;c.setAttribute("href",d.createObjectURL(b)),c.setAttribute("download",userState.program+".java"),c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c)},"codeDownload clicked"),$(".newRelease").onWrap("click",function(a){$("#show-release").modal("show")},"show release clicked")}function initPopups(){$("#saveUser").onWrap("click",saveUserToServer),$("#deleteUser").onWrap("click",deleteUserOnServer),$("#doLogin").onWrap("click",login),$("#saveProgram").onWrap("click",saveAsProgramToServer),$("#saveConfiguration").onWrap("click",saveAsConfigurationToServer),$("#shareProgram").onWrap("click",function(){shareProgramsFromListing()},"share program"),$("#setToken").onWrap("click",function(){setToken($("#tokenValue").val())},"set token"),$(".cancelPopup").onWrap("click",function(){$(".ui-dialog-titlebar-close").click()}),$("#about-join").onWrap("click",function(){$("#show-about").modal("hide")}),$("#login-user").onWrap("hidden.bs.modal",function(){$("#login-user input :not(btn)").val("")}),$("#delete-user").onWrap("hidden.bs.modal",function(){$("#delete-user input :not(btn)").val("")}),$("#register-user").onWrap("hidden.bs.modal",function(){$("#register-user input :not(btn)").val(""),$("#login-user input :not(btn)").val("")}),$("#buttonCancelFirmwareUpdateAndRun").onWrap("click",function(){startProgram()}),$("#doUpdateFirmware").onWrap("click",function(){$("#set-token").modal("hide"),$("#confirmUpdateFirmware").modal("hide"),updateFirmware()},"update firmware of robot"),$(".modal").keyup(function(a){if(a.keyCode===$.ui.keyCode.BACKSPACE&&"password"===a.target.type&&$("#"+a.target.id).val().length>0){var b=$("#"+a.target.id).val().length-1,c=$("#"+a.target.id).val().substring(0,b);$("#"+a.target.id).val(c)}27==a.keyCode&&window.close(),13==a.keyCode&&$(this).find(".modal-footer button:first").click(),a.stopPropagation()})}function initTabs(){$("#tabs").tabs({heightStyle:"content",active:0,beforeActivate:beforeActivateTab}),$("#loadFromListing").onWrap("click",function(){activateProgConfigMenu(),loadFromListing()},"load blocks from program list"),$("#loadConfigurationFromListing").onWrap("click",function(){activateProgConfigMenu(),loadConfigurationFromListing()},"load configuration from configuration list"),$("#deleteFromListing").onWrap("click",function(){var a=$("#programNameTable .selected");a.length>0&&a[0].children[1].textContent===userState.accountName&&$("#confirmDeleteProgram").modal("show")},"Ask for confirmation to delete a program"),$("#doDeleteProgram").onWrap("click",function(){deleteFromListing(),$(".modal").modal("hide")},"delete program"),$("#deleteConfigurationFromListing").onWrap("click",function(){$("#configurationNameTable .selected").length>0&&$("#confirmDeleteConfiguration").modal("show")},"Ask for confirmation to delete a configuration"),$("#doDeleteConfiguration").onWrap("click",function(){deleteConfigurationFromListing(),$(".modal").modal("hide")},"delete configuration from configurations list"),$("#shareFromListing").onWrap("click",function(){var a=$("#programNameTable .selected");if(a.length>0){var b=a[0].children[2].textContent;if("X"===b||"-"===b){var c=a[0].children[0].textContent,d=Blockly.Msg.BUTTON_DO_SHARE+" ("+c+")";$("#headShare").text(d),$("#programShareWith :not(btn)").val(""),$("#read").prop("checked",!0),$("#write").prop("checked",!1),PROGRAM.refreshProgramRelationsList(c,showRelations)}}},"show relations of program"),$("#refreshListing").onWrap("click",function(){PROGRAM.refreshList(showPrograms)},"refresh list of programs"),$("#backConfiguration").onWrap("click",function(){activateProgConfigMenu(),switchToBrickly()}),$("#backProgram").onWrap("click",function(){activateProgConfigMenu(),switchToBlockly()}),$("#backLogging").onWrap("click",function(){activateProgConfigMenu(),bricklyActive?switchToBrickly():switchToBlockly()})}function initLogging(){$("#clearLog").onWrap("click",function(){$("#log li").remove()},"clear LOG list")}function setRobotState(a){a.version&&(userState.version=a.version),a["server.version"]&&(userState.serverVersion=a["server.version"]),a["robot.version"]&&(userState.robotVersion=a["robot.version"]),void 0!=a["robot.wait"]?userState.robotWait=a["robot.wait"]:userState.robotWait="",void 0!=a["robot.battery"]?userState.robotBattery=a["robot.battery"]:userState.robotBattery="",void 0!=a["robot.name"]?userState.robotName=a["robot.name"]:userState.robotName="",void 0!=a["robot.state"]?userState.robotState=a["robot.state"]:userState.robotState="",userState.accountName?($("#iconDisplayLogin").removeClass("error"),$("#iconDisplayLogin").addClass("ok")):($("#iconDisplayLogin").removeClass("ok"),$("#iconDisplayLogin").addClass("error")),"wait"===userState.robotState?($("#iconDisplayRobotState").removeClass("error"),$("#iconDisplayRobotState").removeClass("busy"),$("#iconDisplayRobotState").addClass("wait"),Blockly.hasStartButton&&Blockly.getMainWorkspace().startButton.enable()):"busy"===userState.robotState?($("#iconDisplayRobotState").removeClass("wait"),$("#iconDisplayRobotState").removeClass("error"),$("#iconDisplayRobotState").addClass("busy")):($("#iconDisplayRobotState").removeClass("busy"),$("#iconDisplayRobotState").removeClass("wait"),$("#iconDisplayRobotState").addClass("error"))}function translate(a){$("[lkey]").each(function(a){var b=$(this).attr("lkey"),c=b.replace("Blockly.Msg.",""),d=Blockly.Msg[c];void 0==d&&console.log("UNDEFINED    key : value = "+c+" : "+d),"Blockly.Msg.MENU_LOG_IN"===b?($("#login-user h3").text(d),$(this).html(d)):"Blockly.Msg.MENU_NEW"===b?($("#register-user h3").text(d),$(this).html(d)):"Blockly.Msg.MENU_DELETE_USER"===b?($("#delete-user h3").text(d),$(this).html(d)):"Blockly.Msg.MENU_SAVE_AS"===b?($("#save-program h3").text(d),$("#save-configuration h3").text(d),$(this).html(d)):"Blockly.Msg.MENU_CONNECT"===b?($("#set-token h3").text(d),$(this).html(d)):"Blockly.Msg.POPUP_HIDE_STARTUP_MESSAGE"===b?$("#hideStartupMessage").text(d):"Blockly.Msg.POPUP_TEXT_STARTUP_MESSAGE"===b?$("#popupTextStartupMessage").html(d):"Blockly.Msg.POPUP_ATTENTION"===b?($("#show-message h3").text(d),$("#show-startup-message h3").text(d)):"Blockly.Msg.POPUP_CANCEL"===b?($(".cancelPopup").attr("value",d),$(".backButton").attr("value",d)):"Blockly.Msg.POPUP_ABOUT_JOIN"===b?$("#about-join").html(d):"Blockly.Msg.BUTTON_LOAD"===b?$(".buttonLoad").attr("value",d):"Blockly.Msg.BUTTON_DO_DELETE"===b?$(".buttonDelete").attr("value",d):"Blockly.Msg.BUTTON_DO_SHARE"===b?($(".buttonShare").attr("value",d),$("#show-relations h2").text(d)):"Blockly.Msg.BUTTON_REFRESH"===b?$(".buttonRefresh").attr("value",d):"Blockly.Msg.BUTTON_EMPTY_LIST"===b?$("#clearLog").attr("value",d):"Blockly.Msg.MENU_ROBOT_STATE_INFO"===b?($("#show-robot-info h3").text(d),$(this).html(d)):"Blockly.Msg.MENU_STATE_INFO"===b?($("#show-state-info h3").text(d),$(this).html(d)):"Blockly.Msg.MENU_ABOUT"===b?($("#show-about h3").text(d),$(this).html(d)):"Blockly.Msg.MENU_TITLE_EDIT"===b?($("#head-navi-tooltip-program").attr("data-original-title",d).tooltip("fixTitle"),$("#head-navi-tooltip-configuration").attr("data-original-title",d).tooltip("fixTitle")):"Blockly.Msg.MENU_TITLE_ROBOT"===b?$("#head-navi-tooltip-robot").attr("data-original-title",d).tooltip("fixTitle"):"Blockly.Msg.MENU_TITLE_HELP"===b?$("#head-navi-tooltip-help").attr("data-original-title",d).tooltip("fixTitle"):"Blockly.Msg.MENU_TITLE_USER"===b?$("#head-navi-tooltip-user").attr("data-original-title",d).tooltip("fixTitle"):"Blockly.Msg.MENU_TITLE_USER_STATE"===b?$("#iconDisplayLogin").attr("data-original-title",d).tooltip("fixTitle"):"Blockly.Msg.MENU_TITLE_ROBOT_STATE"===b?$("#iconDisplayRobotState").attr("data-original-title",d).tooltip("fixTitle"):$(this).html(d)})}function switchLanguage(a,b){if(b||userState.language!=a){var c=["DE","EN","FI","DA","ES"];for(c.indexOf(a)<0&&(a="EN"),i=0;i<c.length;i++)$("."+c[i]).css("display","none");$("."+a).css("display","inline"),userState.language=a;var d="blockly/msg/js/"+a.toLowerCase()+".js",e=$.getScript(d);e.then(function(a){switchLanguageInBlockly(),UTIL.getBricklyFrame("#bricklyFrame").eval(a),UTIL.getBricklyFrame("#bricklyFrame").switchLanguageInBrickly()})}}function switchLanguageInBlockly(){translate();var a=null;if(null!==Blockly.mainWorkspace){var b=Blockly.Xml.workspaceToDom(Blockly.mainWorkspace);a=Blockly.Xml.domToText(b)}loadToolbox(userState.toolbox),initProgramEnvironment(a)}function initializeLanguages(){var a;return navigator.language.indexOf("de")>-1?(a="DE",$("#chosenLanguage").text("DE")):navigator.language.indexOf("fi")>-1?(a="FI",$("#chosenLanguage").text("FI")):navigator.language.indexOf("da")>-1?(a="DA",$("#chosenLanguage").text("DA")):navigator.language.indexOf("es")>-1?(a="ES",$("#chosenLanguage").text("ES")):(a="EN",$("#chosenLanguage").text("EN")),$("#language").on("click",".dropdown-menu li a",function(){var a=$(this).text();$("#chosenLanguage").text(a),switchLanguage(a,!1)}),a}function displayInformation(a,b,c,d){"ok"===a.rc?($(".modal").modal("hide"),displayMessage(b,"TOAST",d)):displayMessage(c,"POPUP",d)}function displayMessage(a,b,c){if(void 0!=a){(a.indexOf(".")>=0||a.toUpperCase()!=a)&&LOG.info("Invalid message-key received: "+a);var d="Blockly.Msg."+a,e=Blockly.Msg[a];(void 0===e||""===e)&&(e=a),e.indexOf("$")>=0&&(e=e.replace("$",c)),"POPUP"===b?displayPopupMessage(d,e):"TOAST"===b&&(toastMessages.unshift(e),1===toastMessages.length&&displayToastMessages())}}function displayPopupMessage(a,b){$("#message").attr("lkey",a),$("#message").html(b),$("#show-message").modal("show")}function displayToastMessages(){$("#toastText").text(toastMessages[toastMessages.length-1]),$("#toastContainer").delay(100).fadeIn("slow",function(){$(this).delay(1e3).fadeOut("slow",function(){toastMessages.pop(),toastMessages.length>0&&displayToastMessages()})})}function activateProgConfigMenu(){$("#head-navigation-program-edit > ul > li").removeClass("disabled"),$("#head-navigation-configuration-edit > ul > li").removeClass("disabled"),setHeadNavigationMenuState(-1===userState.id?"logout":"login"),userState.programSaved&&($("#menuSaveProg").parent().removeClass("login"),$("#menuSaveProg").parent().removeClass("disabled"),Blockly.getMainWorkspace().saveButton.enable()),userState.configurationSaved&&($("#menuSaveConfig").parent().removeClass("login"),$("#menuSaveConfig").parent().removeClass("disabled"),UTIL.getBricklyFrame("#bricklyFrame").Blockly.getMainWorkspace().saveButton.enable())}function deactivateProgConfigMenu(){$("#head-navigation-program-edit > ul > li").addClass("disabled"),$("#head-navigation-configuration-edit > ul > li").addClass("disabled")}function pingServer(){COMM.ping(function(a){setRobotState(a)})}function handleServerErrors(){LOG.info("network changed")}function setWorkspaceModified(a){userState.programModified=a}function initBlockly(){if(userState.bricklyReady&&userState.blocklyReady){var a=initializeLanguages();switchLanguage(a,!0)}else setTimeout(function(){initBlockly()},100)}function startPopup(){userState.blocklyTranslated&&userState.bricklyTranslated?$("#show-startup-message").modal("show"):setTimeout(function(){startPopup()},100)}function init(){COMM.setErrorFn(handleServerErrors),initLogging(),initUserState(),$("#tabProgramName").text(userState.program),$("#tabConfigurationName").text(userState.configuration),initTabs(),initPopups(),initHeadNavigation(),setHeadNavigationMenuState("logout"),UTIL.initDataTables(),initProgramNameTable(),initConfigurationNameTable(),initRelationsTable(),$("#menuTabProgram").parent().addClass("disabled"),$("#tabProgram").addClass("tabClicked"),$("#head-navigation-configuration-edit").css("display","none"),$(".modal").on("shown.bs.modal",function(){$(this).find("[autofocus]").focus()}),$(window).on("beforeunload",function(a){return userState.programModified||userState.configurationModified?-1===userState.id?Blockly.Msg.POPUP_BEFOREUNLOAD:Bl\u00f6ockly.Msg.POPUP_BEFOREUNLOAD_LOGGEDIN:void 0}),$('[rel="tooltip"]').tooltip({placement:"right"}),UTIL.checkVisibility(function(){var a=UTIL.checkVisibility();LOG.info("this tab visible: "+a),a||SIM.setPause(!0)}),switchRobot(userState.robot),COMM.json("/toolbox",{cmd:"loadT",name:userState.toolbox,owner:" "},function(a){injectBlockly(a)}),initBlockly(),startPopup();setInterval(function(){pingServer()},5e3)}var USER={};!function(a){USER.login=function(a,b,c){COMM.json("/user",{cmd:"login",accountName:a,password:b},c,"login user '"+a+"'")},USER.logout=function(a){COMM.json("/user",{cmd:"logout"},a,"logout user")},USER.saveUserToServer=function(a,b,c,d,e){COMM.json("/user",{cmd:"createUser",accountName:a,userName:b,userEmail:c,password:d,role:"TEACHER"},e,"save user '"+a+"' to server")},USER.deleteUserOnServer=function(a,b,c){COMM.json("/user",{cmd:"deleteUser",accountName:a,password:b},c,"delete user '"+a+"' on server")}}($);var ROBOT={};!function(a){ROBOT.updateFirmware=function(a){COMM.json("/admin",{cmd:"updateFirmware"},a,"update firmware")},ROBOT.setToken=function(a,b){COMM.json("/admin",{cmd:"setToken",token:a},b,"set token '"+a+"'")},ROBOT.setRobot=function(a,b){COMM.json("/admin",{cmd:"setRobot",robot:a},b,"set robot '"+a+"'")}}($);var PROGRAM={};!function(a){PROGRAM.saveAsProgramToServer=function(a,b,c,d){COMM.json("/program",{cmd:"saveAsP",name:a,timestamp:b,program:c},d,"save program to server with new name '"+a+"'")},PROGRAM.saveProgramToServer=function(a,b,c,d,e){COMM.json("/program",{cmd:"saveP",name:a,shared:b,timestamp:c,program:d},e,"save program '"+a+"' to server")},PROGRAM.shareProgram=function(a,b,c,d){COMM.json("/program",{cmd:"shareP",programName:a,userToShare:b,right:c},d,"share program '"+a+"' with user '"+b+"' having right '"+c+"'")},PROGRAM.deleteProgramFromListing=function(a,b){COMM.json("/program",{cmd:"deleteP",name:a},b,"delete program '"+a+"'")},PROGRAM.loadProgramFromListing=function(a,b,c){COMM.json("/program",{cmd:"loadP",name:a,owner:b},c,"load program '"+a+"' owned by '"+b+"'")},PROGRAM.refreshList=function(a){COMM.json("/program",{cmd:"loadPN"},a,"refresh program list")},PROGRAM.showJavaProgram=function(a,b,c,d,e){COMM.json("/program",{cmd:"showJavaP",name:a,configuration:b,programText:c,configurationText:d},e,"show Java program '"+a)},PROGRAM.runOnBrick=function(a,b,c,d,e){COMM.json("/program",{cmd:"runP",name:a,configuration:b,programText:c,configurationText:d},e,"run program '"+a+"' with configuration '"+b+"'")},PROGRAM.refreshProgramRelationsList=function(a,b){COMM.json("/program",{cmd:"loadPR",name:a},b,"refresh program relations list")},PROGRAM.checkProgramCompatibility=function(a,b,c,d,e){COMM.json("/program",{cmd:"checkP",name:a,configuration:b,programText:c,configurationText:d},e,"check program '"+a+"' with configuration '"+b+"'")}}($);var CONFIGURATION={};!function(a){CONFIGURATION.saveAsConfigurationToServer=function(a,b,c){COMM.json("/conf",{cmd:"saveAsC",name:a,configuration:b},c,"save configuration to server with new name "+a)},CONFIGURATION.saveConfigurationToServer=function(a,b,c){COMM.json("/conf",{cmd:"saveC",name:a,configuration:b},c,"save configuration "+a+" to server")},CONFIGURATION.deleteConfigurationFromListing=function(a,b){COMM.json("/conf",{cmd:"deleteC",name:a},b,"delete configuration "+a)},CONFIGURATION.loadConfigurationFromListing=function(a,b){COMM.json("/conf",{cmd:"loadC",name:a,owner:userState.accountName},b,"load configuration "+a)},CONFIGURATION.refreshList=function(a){COMM.json("/conf",{cmd:"loadCN"},a,"refresh configuration list")}}($);var UTIL={};!function(a){UTIL.setCookie=function(a,b){var c=new Date;c.setTime(c.getTime()+2592e6),document.cookie=a+"="+b+";expires="+c.toUTCString()},UTIL.getCookie=function(a){var b=document.cookie.match("(^|;) ?"+a+"=([^;]*)(;|$)");return b?b[2]:null},UTIL.formatDate=function(a){if(a){var b=a.substring(0,4),c=a.substring(5,7),d=a.substring(8,10),e=a.substring(11,13),f=a.substring(14,16),g=a.substring(17,19),h=d+"."+c+"."+b+", "+e+":"+f+":"+g;return h}return""},UTIL.formatDateComplete=function(a){if(a){for(var b=a.substring(0,4),c=a.substring(5,7),d=a.substring(8,10),e=a.substring(11,13),f=a.substring(14,16),g=a.substring(17,19),h=a.substring(20,23);h.length<3;)h+="0";var i=d+"."+c+"."+b+", "+e+":"+f+":"+g+"."+h;return i}return""},UTIL.parseDate=function(a){if(a){var b=a.split(", ")[0],c=a.split(", ")[1],d=b.split(".")[0],e=b.split(".")[1]-1,f=b.split(".")[2],g=c.split(":")[0],h=c.split(":")[1],i=c.split(":")[2],j=c.split(".")[1],k=new Date(f,e,d,g,h,i,j);return k.getTime()}return 0},UTIL.formatResultLog=function(a){var b="{",c=!1;for(key in a)c?b+=",":c=!0,b+='"'+key+'":',a.hasOwnProperty(key)&&(b+=a[key].length>100?'"'+JSON.stringify(a[key]).substring(1,100)+' ..."':JSON.stringify(a[key]));return b+="}"},UTIL.initDataTables=function(){jQuery.extend(jQuery.fn.dataTableExt.oSort["date-de-asc"]=function(a,b){return a=UTIL.parseDate(a),b=UTIL.parseDate(b),b>a?-1:a>b?1:0},jQuery.fn.dataTableExt.oSort["date-de-desc"]=function(a,b){return a=UTIL.parseDate(a),b=UTIL.parseDate(b),b>a?1:a>b?-1:0})},UTIL.calcDataTableHeight=function(){return Math.round(a(window).height()-260)},UTIL.cacheBlocks=function(){if(userState.programBlocksSaved=null,userState.programBlocks=null,null!==Blockly.mainWorkspace){var a=Blockly.Xml.workspaceToDom(Blockly.mainWorkspace);userState.programBlocksSaved=Blockly.Xml.domToText(a);for(var b=Blockly.getMainWorkspace().getTopBlocks(),c=0;c<b.length;c++)if("robControls_start"==b[c].type){var d=b[c].getRelativeToSurfaceXY();b[c].moveBy(25-d.x,25-d.y);break}a=Blockly.Xml.workspaceToDom(Blockly.mainWorkspace),userState.programBlocks=Blockly.Xml.domToText(a);for(var b=Blockly.getMainWorkspace().getTopBlocks(),c=0;c<b.length;c++)if("robControls_start"==b[c].type){var d=b[c].getRelativeToSurfaceXY();b[c].moveBy(25-d.x,25-d.y);break}}},UTIL.checkVisibility=function(){var a,b,c={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(a in c)if(a in document){b=c[a];break}return function(c){return c&&document.addEventListener(b,c),!document[a]}},UTIL.getBricklyFrame=function(b){var d,c=a(b).get(0);return c.contentWindow?c.contentWindow:c.window?c.window:(!d&&c.contentDocument&&(d=c.contentDocument),!d&&c.document&&(d=c.document),d&&d.defaultView?d.defaultView:d&&d.parentWindow?d.parentWindow:void 0)}}($);var bricklyActive=!1,userState={},toastMessages=[],id,newProgram=function(){return userState.programModified?(-1===userState.id?displayMessage("POPUP_BEFOREUNLOAD","POPUP",""):displayMessage("POPUP_BEFOREUNLOAD_LOGGEDIN","POPUP",""),userState.programModified=!1,!1):(setProgram("NEPOprog"),userState.programShared=!1,userState.programTimestamp="",initProgramEnvironment(),$("#menuSaveProg").parent().addClass("disabled"),Blockly.getMainWorkspace().saveButton.disable(),$("#tabProgram").click(),!0)},start;$(document).ready(WRAP.fn3(init,"page init"));